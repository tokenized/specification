#
# Order Action: Issuer to signal to the smart contract that the tokens that a particular public address(es) owns are to be confiscated, frozen, thawed or reconciled.
#

code: E1

metadata:
  name: Order
  label: Order Action
  description: "Order Action -  Issuer to signal to the smart contract that the tokens that a particular public address(es) owns are to be confiscated, frozen, thawed or reconciled."
  validation: AssetCreation
  rejection: Rejection

rules:
  fee:
  inputs:
    - name: Issuer
      label: "Issuer's Public Address"
      comments:

  outputs:
    - name: Contract
      label: Contract Public Address
      comments:

fields:
  - name: Header
    label: Header
    description: "Common header data for all actions"
    type: Header
    notes: "Common header data for all actions. Can be changed by Issuer or Operator at their discretion."

  - name: AssetType
    label: Asset Type
    description: "eg. Share, Bond, Ticket"
    type: fixedchar
    size: 3
    example_hex: 534843
    example_value: "SHC"
    notes: ""

  - name: AssetCode
    label: Asset Code
    description: "32 randomly generated bytes.  Each Asset Code should be unique.  However, an Asset Code is always linked to a Contract that is identified by the public address of the Contract wallet. The Asset Type + Asset Code = Asset Code.  An Asset Code is a human readable identifier that can be used in a similar way to a Bitcoin (BSV) address."
    type: AssetCode
    example_hex: 61706d3271737a6e686b7332337a386438337534317338303139687972693369
    notes: "Cannot be changed by issuer, operator or smart contract."

  - name: ComplianceAction
    label: Compliance Action
    description: "Freeze (F), Thaw (T), Confiscate (C), Reconciliation (R)"
    type: fixedchar
    size: 1
    example_hex: 46
    example_value: "F"
    notes: ""

  - name: TargetAddresses
    label: Target Addresses
    type: TargetAddress[]
    # array size is number of bits to serialize the size of the array
    size: 16

  - name: DepositAddress
    label: Deposit Address
    description: "The public address for confiscated tokens to be deposited in.  Null for Freeze, Thaw, actions. For Reconciliation actions the deposit address is who receives bitcoin."
    type: PublicKeyHash
    notes: "Eventually the supporting evidence/explanation can be supported by a Subfield that has the public address (and a signed message) owned by a legal authority for ID verification/certification purposes."

  - name: AuthorityName
    label: Authority Name
    description: "Length 0-255 bytes. Enforcement Authority Name (eg. Issuer, Queensland Police Service, Tokenized, etc.)"
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 2453757072656d6520616e6420446973747269637420436f75727473204272697362616e65
    example_value: "Supreme and District Courts Brisbane"
    notes: ""

  - name: SigAlgoAddressList
    label: Signature Algorithm for Address List
    description: "0 = No Registry-signed Message, 1 = ECDSA+secp256k1"
    type: uint
    size: 1
    example_hex: 01
    example_value: 1
    notes: ""

  - name: AuthorityPublicKey
    label: Authority Public Key
    description: "Length 0-255 bytes. Public Key associated with the Enforcement Authority"
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 00
    example_value: ""
    notes: ""

  - name: OrderSignature
    label: Authority Order Signature
    description: "Length 0-255 bytes. Signature for a message that lists out the target addresses and deposit address. Signature of (Contract Address, Asset Code, Compliance Action, Supporting Evidence Hash, Time Out Expiration, TargetAddress1, TargetAddress1Qty, TargetAddressX, TargetAddressXQty,...,DepositAddress)"
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 00
    example_value: ""
    notes: ""

  - name: SupportingEvidenceTxId
    label: Supporting Evidence Hash
    description: "SHA-256: warrant, court order, etc."
    type: TxId
    example_hex: c236f77c7abd7249489e7d2bb6c7e46ba3f4095956e78a584af753ece56cf6d1
    example_value: "c236f77c7abd7249489e7d2bb6c7e46ba3f4095956e78a584af753ece56cf6d1"
    notes: ""

  - name: RefTxns
    label: Ref Txns
    description: "The request/response actions that were dropped.  The entire txn for both actions is included as evidence that the actions were accepted into the mempool at one point and that the senders (token/Bitcoin) signed their intent to transfer.  The management of this record keeping is off-chain and managed by the issuer or operator to preserve the integrity of the state of the tokens. Only applicable for reconcilliation actions.  No subfield when F, T, R is selected as the Compliance Action subfield."
    type: varchar
    size: 32
    example_hex: 00
    example_value: ""
    notes: "Can be null.  Dropped actions that require a reconciliation action to fix the break in the chain are considered to be an extremely rare event."

  - name: FreezePeriod
    label: Freeze Period
    description: "Used for a 'time out'.  Tokens are automatically unfrozen after the expiration timestamp without requiring a Thaw Action. Null value for Thaw, Confiscation and Reconciallitaion orders."
    type: Timestamp
    example_hex: 00000166550ce380
    example_value: "Tue Oct 09 2018 05:00:00 GMT+1000 (AEST)"
    notes: ""

  - name: Message
    label: Message Period
    description:
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 32
    example_hex: 00000023536f7272792c206275742074686520636f757274206f72646572206d616465206d652e
    example_value: "Sorry, but the court order made me."
    notes: ""

#
# Contract Offer Action: The Contract Offer action allows the Issuer to tell the smart contract what they want the details (labels, data, T&C's, etc.) of the Contract to be on-chain in a public and immutable way. The Contract Offer action 'initializes' a generic smart contract that has been spun up by either the Smart Contract Operator or the Issuer. This on-chain action allows for the positive response from the smart contract with either a Contract Formation Action or a Rejection Action.
#

code: C1

metadata:
  name: ContractOffer
  label: "Contract Offer Action"
  description: "The Contract Offer action allows the Issuer to tell the smart contract what they want the details (labels, data, T&C's, etc.) of the Contract to be on-chain in a public and immutable way. The Contract Offer action 'initializes' a generic smart contract that has been spun up by either the Smart Contract Operator or the Issuer. This on-chain action allows for the positive response from the smart contract with either a Contract Formation Action or a Rejection Action."
  validation: AssetCreation
  rejection: Rejection

rules:
  fee:
  inputs:
    - name: Issuer
      label: "Issuer's Public Address"
      comments: "The smart contract sets the issuer public address with whatever public address is in Index 0 of the first valid Contract Offer.  From then on, the SC will only respond to 'commands' (request actions) from this address with respect to actions that are issuer controlled according to the protocol."

    - name: ContractOperator
      label: "Contract Operator's Public Address (Optional)"
      comments: "The one exception to the rule above.  The Contract Operator can nominate a secondary controlling public address that can act on behalf of the issuer for issuer related requests. Typically this will be the Smart Contract Operator. (Optional)"

  outputs:
    - name: Contract
      label: "Contract Public Address"
      comments:

fields:
  - name: Header
    label: "Header"
    description: "Common header data for all actions"
    type: Header
    notes: "Common header data for all actions. Can be changed by Issuer or Operator at their discretion."

  - name: ContractName
    label:
    description: "Can be any unique identifying string, including human readable names for branding/vanity purposes.   [Contract identifier (instance) is the bitcoin public key hash address. If the Public Address is lost, then the issuer will have to reissue the entire contract, Asset definition and tokens with the new public address.]. Smart contracts can be branded and specialized to suit any terms and conditions."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 1d5465736c61202d205368617265686f6c6465722041677265656d656e74
    example_value: "Tesla - Shareholder Agreement"
    notes: ""

  - name: ContractFileType
    label: Contract File Type
    description: "1 - SHA-256 Hash, 2 - Markdown"
    type: uint
    size: 1
    example_hex: 01
    example_value: "1"
    notes: "Contract File - Amendments can be restricted to a vote."

  - name: ContractFile
    label: Contract File
    description: "SHA-256 hash of the contract file or markdown data for contract file specific to the smart contract and relevant Assets.  Legal and technical information. (eg. pdf)"
    type: varbin
    # varbin size is number of bits to serialize the size of the data
    size: 32
    example_hex: c236f77c7abd7249489e7d2bb6c7e46ba3f4095956e78a584af753ece56cf6d1
    example_value: "c236f77c7abd7249489e7d2bb6c7e46ba3f4095956e78a584af753ece56cf6d1"
    notes: ""

  - name: SupportingDocsFileType
    label: Supporting Documentation File Type
    description: "1 - 7z"
    type: uint
    size: 1
    example_hex: 01
    example_value: "1"
    notes: "The file type of the supporting documents ('attached') that are important to the contract."

  - name: SupportingDocs
    label: Supporting Documentation
    description: ""
    type: varchar
    size: 32
    example_hex: c236f77c7abd7249489e7d2bb6c7e46ba3f4095956e78a584af753ece56cf6d1
    example_value: "c236f77c7abd7249489e7d2bb6c7e46ba3f4095956e78a584af753ece56cf6d1"
    notes: "File of all supporting documents that are important to the contract."

  - name: GoverningLaw
    label: Governing Law
    description: "5 Letter Code to Identify which governing law the contract will adhere to.  Disputes are to be settled by this law in the jurisdiction specified below. Private dispute resolution organizations can be used as well.  A custom code just needs to be defined."
    type: fixedchar
    size: 5
    example_hex: 5553410000
    example_value: "USA"
    notes: "Governing Law - Amendments can be restricted to a vote."

  - name: Jurisdiction
    label: Jurisdiction
    description: "Legal proceedings/arbitration will take place using the specified Governing Law in this location."
    type: fixedchar
    size: 5
    example_hex: 55532d4341
    example_value: "US-CA"
    notes: "Jurisdiction - Amendments can be restricted to a vote."

  - name: ContractExpiration
    label: Contract Expiration
    description: "All actions related to the contract will cease to work after this timestamp. The smart contract will stop running.  This will allow many token use cases to be able to calculate total smart contract running costs for the entire life of the contract. Eg. an issuer is creating tickets for an event on the 5th of June 2018.  The smart contract will facilitate exchange and send transactions up until the 6th of June.  Wallets can use this to forget tokens that are no longer valid - or at least store them in an 'Expired' folder."
    type: Timestamp
    example_hex: 000000005c78d0f0
    example_value: "Wed May 09 2018 00:00:00 GMT+1000 (AEST)"
    notes: "Contract Expiration - Amendments can be restricted to a vote."

  - name: ContractURI
    label: Contract URI
    description: "Points to an information page that also has a copy of the Contract.  Anyone can go to the website to have a look at the price/token, information about the Issuer (company), information about the Asset, legal information, etc.  There will also be a way for Token Owners to vote on this page and contact details with the Issuer/tokenized companies. Could be a IPv6/IPv4, an IPFS address (hash) or txn-id for on-chain information or even a public address (DNS)."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 3468747470733a2f2f746f6b656e697a65642e636f6d2f436f6e74726163742f3371656f534367374a6d66536e4a65734a466f6a6a
    example_value: "https://tokenized.com/Contract/3qeoSCg7JmfSnJesJFojj"
    notes: ""

  - name: IssuerName
    label: Issuer Name
    description: "Length 0-255 bytes. 0 is not valid.Issuing entity (company, organization, individual).  Can be any unique identifying string, including human readable names for branding/vanity purposes. "
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 0a5465736c6120496e632e
    example_value: "Tesla Inc."
    notes: ""

  - name: IssuerType
    label: Issuer Type
    description: "P - Public Company Limited by Shares, C - Private Company Limited by Shares, I - Individual, L - Limited Partnership, U -Unlimited Partnership, T - Sole Proprietorship, S - Statutory Company, O - Non-Profit Organization, N - Nation State, G - Government Agency, U - Unit Trust, D - Discretionary Trust.  Found in 'Entities' (Specification/Resources)."
    type: fixedchar
    size: 1
    example_hex: 50
    example_value: "P"
    notes: "Issuer Type - Amendments can be restricted to a vote."

  - name: IssuerLEI
    label: Issuer's Legal Entity Identifier
    description: "Null is valid. A Legal Entity Identifier (or LEI) is an international identifier made up of a 20-character identifier that identifies distinct legal entities that engage in financial transactions. It is defined by ISO 17442.[1] Natural persons are not required to have an LEI; they’re eligible to have one issued, however, but only if they act in an independent business capacity.[2] The LEI is a global standard, designed to be non-proprietary data that is freely accessible to all.[3] As of December 2018, over 1,300,000 legal entities from more than 200 countries have now been issued with LEIs."
    type: fixedchar
    size: 20
    example_hex: 3534393330303834554b4c564d59323244533136
    example_value: "54930084UKLVMY22DS16"
    notes: "ISO 17442 - https://en.wikipedia.org/wiki/Legal_Entity_Identifier"

  - name: IssuerLogoURL
    label: Issuer Logo URL
    description: "The URL of the Issuers logo."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: "2368747470733a2f2f6578616d706c652e636f6d2f696d616765732f6c6f676f2e706e67"
    example_value: "https://example.com/images/logo.png"
    notes: ""

  - name: ContractOperatorIncluded
    label: Contract Operator Included
    description: "If true, then the second input is a contract operator. If false, then all additional inputs are just funding and \"includes\" fields are skipped in serialization."
    type: bool
    includes:
      - ContractOperatorID
      - OperatorLEI

  - name: ContractOperatorID
    label: Contract Operator ID
    description: "Length 0-255 bytes. 0 is valid. Smart Contract Operator identifier. Can be any unique identifying string, including human readable names for branding/vanity purposes. Can also be null or the Issuer."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 09546f6b656e697a6564
    example_value: "Tokenized"
    notes: ""

  - name: OperatorLEI
    label: Operator's Legal Entity Identifier
    description: "Null is valid. A Legal Entity Identifier (or LEI) is an international identifier made up of a 20-character identifier that identifies distinct legal entities that engage in financial transactions. It is defined by ISO 17442.[1] Natural persons are not required to have an LEI; they’re eligible to have one issued, however, but only if they act in an independent business capacity.[2] The LEI is a global standard, designed to be non-proprietary data that is freely accessible to all.[3] As of December 2018, over 1,300,000 legal entities from more than 200 countries have now been issued with LEIs."
    type: fixedchar
    size: 20
    example_hex: 3534393330303834554b4c564d59323244533136
    example_value: "54930084UKLVMY22DS16"
    notes: "ISO 17442 - https://en.wikipedia.org/wiki/Legal_Entity_Identifier"

  - name: ContractAuthFlags
    label: Contract Authorization Flags
    description: "Authorization Flags aka Terms and Conditions that the smart contract can enforce.  Other terms and conditions that are out of the smart contract's control are listed in the actual Contract File."
    type: bin
    size: 16
    example_hex: 492492496db6db6d249b6db6db6db6c0
    example_value: "010010010010010010010010010010010110110110110110110110110110110100100100100110110110110110110110110110110110110110110110110000000"
    notes: "Contract Flags - Amendments can be restricted to a vote.  Specified in the Voting System."

  - name: ActionFee
    label: Contract Fee
    description: "The tokens available for payment of action fees. One is required per action and must be included in the action request transaction. i.e. Bitcoin amount or an AUD backed token and amount."
    type: Fee[]
    size: 8

  - name: VotingSystems
    label: Voting Systems
    description: "A list of voting systems."
    type: VotingSystem[]
    notes: ""

  - name: RestrictedQtyAssets
    label: Restricted Qty of Assets
    description: "Number of Assets (non-fungible) permitted on this contract. 0 if unlimited which will display an infinity symbol in UI"
    type: uint
    size: 8
    example_hex: 0000000000000001
    example_value: "1"
    notes: "Qty of Assets - Amendments can be restricted to a vote."

  - name: ReferendumProposal
    label: Referendum Proposal
    description: "A Referendum is permitted for Proposals (outside of smart contract scope)."
    type: bool
    example_hex: 01
    example_value: "true"
    notes: "General Governance"

  - name: InitiativeProposal
    label: Initiative Proposal
    description: "An initiative is permitted for Proposals (outside of smart contract scope)."
    type: bool
    example_hex: 01
    example_value: true
    notes: ""

  - name: Registries
    label: Registries
    description: "A list Registries"
    type: Registry[]

  - name: IssuerAddressIncluded
    label: Issuer Address Included
    description: "Physical/mailing address. False means the \"includes\" fields are skipped in serialization."
    type: bool
    includes:
      - UnitNumber
      - BuildingNumber
      - Street
      - SuburbCity
      - TerritoryStateProvinceCode
      - CountryCode
      - PostalZIPCode
    notes: "Issuer Details - Can always be amended by issuer/smart contract operator."

  - name: UnitNumber
    label: Unit Number
    description: "Issuer Address Details (eg. HQ)"
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 0132
    example_value: "2"
    notes: ""

  - name: BuildingNumber
    label: Building Number
    description: ""
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 053133353737
    example_value: "13577"
    notes: ""

  - name: Street
    label: Street
    description: ""
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 16
    example_hex: 000c466169726d6f6e7420417665
    example_value: "Fairmont Ave"
    notes: ""

  - name: SuburbCity
    label: Suburb/City
    description: ""
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 07526f62696e6f68
    example_value: "Robinoh"
    notes: ""

  - name: TerritoryStateProvinceCode
    label: Territory/State/Province Code
    description: ""
    type: fixedchar
    size: 5
    example_hex: 4243000000
    example_value: "BC"
    notes: ""

  - name: CountryCode
    label: Country Code
    description: ""
    type: fixedchar
    size: 3
    example_hex: 555341
    example_value: "USA"
    notes: ""

  - name: PostalZIPCode
    label: Postal/ZIP Code
    description: ""
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 053530323130
    example_value: "50210"
    notes: ""

  - name: EmailAddress
    label: Email Address
    description: "Length 0-255 bytes. 0 is valid (no EmailAddress). Address for text-based communication: eg. email address, Bitcoin address"
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 136a616d657340746f6b656e697a65642e636f6d
    example_value: "james@tokenized.com"
    notes: ""

  - name: PhoneNumber
    label: Phone Number
    description: "Length 0-50 bytes. 0 is valid (no Phone subfield).Phone Number for Entity."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 0a30343230313939393939
    example_value: "0420199999"
    notes: ""

  - name: KeyRoles
    label: Key Roles
    description: "A list of Key Roles."
    type: KeyRole[]

  - name: NotableRoles
    label: Notable Roles
    description: "A list of Notable Roles."
    type: NotableRole[]

# Functions for configuring the action
functions:
    - name: SetIssuerAddress
      description: Sets the issuer's mailing address on the contract.
      type: set
      params:
          - name: unit
            type: string
            field: UnitNumber

          - name: building
            type: string
            field: BuildingNumber

          - name: street
            type: string
            field: Street

          - name: city
            type: string
            field: SuburbCity

          - name: state
            type: string
            field: TerritoryStateProvinceCode

          - name: countryCode
            type: string
            field: CountryCode

          - name: postalCode
            type: string
            field: PostalZIPCode

          - name: hidden
            type: string
            field: IssuerAddressIncluded
            value: true

    - name: AddKeyRole
      description: Adds a key role to the contract
      type: append
      append_type: KeyRole
      params:
          - name: roleType
            type: uint
            size: 1
            field: Type

          - name: name
            type: string
            field: Name

    - name: AddNotableRole
      description: Adds a notable role to the contract
      type: append
      append_type: NotableRole
      params:
          - name: roleType
            type: uint
            size: 1
            field: Type

          - name: name
            type: string
            field: Name
